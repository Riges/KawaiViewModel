<?php/** * Class Vbf_Mvc_View */class Vbf_Mvc_View{    /**     * @var     */    private $viewFile;    /**     * @var array     */    private $parameters;    /**     * @var     */    private $frontController;    /**     * @param $frontController     * @param $viewFile     * @param null $parameters     */    public function __construct($frontController, $viewFile, $parameters = null)    {        $this->frontController = $frontController;        $this->viewFile = $viewFile;        if (is_array($parameters)) {            $this->parameters = $parameters;        } else if ($parameters == null) {            $this->parameters = array();        } else {            throw new Exception("'parameters' should be null or an array.");        }    }    /**     * @param $name     * @return bool     */    public function parameterExists($name)    {        return array_key_exists($name, $this->parameters);    }    /**     * @param $type     * @param $name     * @throws Exception     */    private function forceParameterType($type, $name)    {        if (settype($this->parameters[$name], $type) !== TRUE) {            throw new Exception("Unable to force type $type for parameter $name");        }    }    /**     * @param $name     * @throws Exception     */    protected function ensureParameterExists($name)    {        if (!$this->parameterExists($name)) {            throw new Exception("Unknown view parameter : $name");        }    }    /**     * @param $type     * @param $name     */    public function initializeParameter($type, $name)    {        $this->ensureParameterExists($name);        $this->forceParameterType($type, $name);    }    /**     * @param $type     * @param $name     * @param $defaultValue     */    public function initializeParameterDefault($type, $name, $defaultValue)    {        if (!$this->parameterExists($name)) {            $this->$name = $defaultValue;        }        $this->forceParameterType($type, $name);    }    /**     * @param $name     * @return mixed     */    public function __get($name)    {        $this->ensureParameterExists($name);        return $this->parameters[$name];    }    /**     * @param $name     * @param $value     */    public function __set($name, $value)    {        $this->parameters[$name] = $value;    }    /**     * @return string     * @throws Exception     */    public function render()    {        ob_start();        try {            require($this->viewFile);        } catch (Exception $e) {            ob_end_clean();            throw $e;        }        $buffer = ob_get_contents();        ob_end_clean();        return $buffer;    }    /**     *     */    public function display()    {        require($this->viewFile);    }    /**     * @param $method     * @param $uri     * @param $acceptHeader     * @return string     */    public function getSiteView($method, $uri, $acceptHeader)    {        ob_start();        $ft = new Knb_FrontController();        $ft->initialize($method, $uri, $acceptHeader);        $ft->run();        $buffer = ob_get_clean();        return trim($buffer);    }    /*     * To be used from the view     */    /**     * @param $uri     * @param bool $urlencode     * @return mixed     */    public function formatUri($uri, $urlencode = false)    {        return $this->frontController->formatUri($uri, $urlencode);    }    /**     * @param $uri     * @param bool $urlencode     * @return mixed     */    public function createUriFromResource($uri, $urlencode = false)    {        return $this->frontController->createUriFromResource($uri, $urlencode);    }    /**     * @param $uri     * @param bool $urlencode     * @return mixed     */    public function createUriFromModule($uri, $urlencode = false)    {        return $this->frontController->createUriFromModule($uri, $urlencode);    }    /**     * @param $uri     * @param bool $urlencode     * @return mixed     */    public function createUriFromBase($uri, $urlencode = false)    {        return $this->frontController->createUriFromBase($uri, $urlencode);    }    /**     * @param $params     * @param $func     * @param bool $guardAny     */    public function guardParameters($params, $func, $guardAny = true)    {        foreach ($params as $param) {            $this->$param = Vbf_Guard::guardAny($this->$param, $func, $guardAny);        }    }    /**     * @param $except     * @param $func     * @param bool $guardAny     */    public function guardAllParameters($except, $func, $guardAny = true)    {        if ($except === NULL) $except = array();        if (!is_array($except)) $except = array($except);        $keys = array_keys($this->parameters);        $keys = array_diff($keys, $except);        $this->guardParameters($keys, $func, $guardAny);    }    /**     * @param $params     * @param bool $guardAny     */    public function guardParametersHtml($params, $guardAny = true)    {        $this->guardParameters($params, Vbf_Guard::getgetHtmlentitiesFunc(), $guardAny);    }    /**     * @param null $except     * @param bool $guardAny     */    public function guardAllParametersHtml($except = NULL, $guardAny = true)    {        $this->guardAllParameters($except, Vbf_Guard::getHtmlentitiesFunc(), $guardAny);    }    /**     * @param $params     * @param bool $guardAny     */    public function guardParametersXml($params, $guardAny = true)    {        $this->guardParameters($params, Vbf_Guard::getgetXmlentitiesFunc(), $guardAny);    }    /**     * @param null $except     * @param bool $guardAny     */    public function guardAllParametersXml($except = NULL, $guardAny = true)    {        $this->guardAllParameters($except, Vbf_Guard::getXmlentitiesFunc(), $guardAny);    }}